
# AYN Document Generation: Stunning Multi-Language PDF & Excel

## Overview

Enable AYN to generate beautiful, professional PDF and Excel documents on-demand in **English**, **Arabic (RTL)**, and **French** when users ask naturally in chat. The documents will feature proper text direction, professional typography, and elegant styling.

---

## What You'll Get

### Language-Specific Features

| Language | PDF Support | Excel Support |
|----------|-------------|---------------|
| **English** | LTR layout, professional fonts | Standard columns, left-aligned |
| **Arabic** | RTL layout, Noto Sans Arabic font, right-aligned text | RTL columns, right-aligned cells |
| **French** | LTR layout, proper accent handling | French locale formatting |

### Document Quality
- Gradient branded headers with AYN logo
- Professional typography with proper font fallbacks
- Tables with alternating row colors
- Page numbers and timestamps
- Download cards in chat with animated styling

---

## Architecture

```text
User: "Ø§Ø¹Ù…Ù„ Ù„ÙŠ PDF Ø¹Ù† Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØªØ¬Ø¯Ø¯Ø©"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ayn-unified                    â”‚
â”‚  1. Detect intent = 'document'          â”‚
â”‚  2. Detect language (ar/en/fr)          â”‚
â”‚  3. Call LLM for structured content     â”‚
â”‚  4. Call generate-document function     â”‚
â”‚  5. Return download link                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        generate-document                 â”‚
â”‚  (New Edge Function)                     â”‚
â”‚                                          â”‚
â”‚  â€¢ Parse content structure              â”‚
â”‚  â€¢ Detect language â†’ set RTL/fonts      â”‚
â”‚  â€¢ Generate PDF with jsPDF              â”‚
â”‚  â€¢ Generate Excel with xlsx             â”‚
â”‚  â€¢ Upload to Supabase Storage           â”‚
â”‚  â€¢ Return signed URL (7-day expiry)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ResponseCard.tsx                  â”‚
â”‚  Detects: ðŸ“„ [Title](url)               â”‚
â”‚  Shows beautiful download card          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Files to Create/Modify

### 1. NEW: `supabase/functions/generate-document/index.ts`

Creates professional PDF and Excel files with multi-language support.

**Key Features:**
- **Language Detection**: Auto-detect Arabic/French/English from content
- **RTL Support**: Arabic PDFs render right-to-left with proper text alignment
- **Font Handling**: Embed Noto Sans Arabic font for perfect Arabic rendering
- **Professional Styling**: Gradient headers, colored tables, branded footer

**PDF Generation Logic:**
```typescript
// Language-aware configuration
const isRTL = language === 'ar';
const fontFamily = isRTL ? 'NotoSansArabic' : 'Helvetica';

// RTL text positioning
if (isRTL) {
  doc.setR2L(true);
  doc.text(title, pageWidth - margin, y, { align: 'right' });
} else {
  doc.text(title, margin, y, { align: 'left' });
}

// Header with gradient effect (drawn as colored rectangles)
doc.setFillColor(26, 26, 46); // #1a1a2e
doc.rect(0, 0, pageWidth, 40, 'F');

// Branded footer with language-aware text
const footerText = {
  ar: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© AYN',
  fr: 'GÃ©nÃ©rÃ© par AYN',
  en: 'Generated by AYN'
}[language];
```

**Excel Generation Logic:**
```typescript
// RTL worksheet direction for Arabic
if (language === 'ar') {
  ws['!RTL'] = true;
}

// Column headers in correct language
const headers = {
  ar: ['Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'Ø§Ù„Ù‚ÙŠÙ…Ø©', 'Ø§Ù„ÙˆØ­Ø¯Ø©'],
  fr: ['Titre', 'Valeur', 'UnitÃ©'],
  en: ['Title', 'Value', 'Unit']
}[language];
```

### 2. MODIFY: `supabase/functions/ayn-unified/index.ts`

**Change 1: Add document intent detection (in detectIntent function)**

```typescript
// Document generation keywords in all languages
const documentKeywords = [
  // English
  'create pdf', 'make pdf', 'generate pdf', 'pdf report', 'pdf document',
  'create excel', 'make excel', 'excel sheet', 'spreadsheet', 'xlsx',
  'export as', 'make a report', 'generate report', 'document about',
  // Arabic
  'Ø§Ø¹Ù…Ù„ pdf', 'Ø§Ù†Ø´Ø¦ pdf', 'Ù…Ù„Ù pdf', 'ØªÙ‚Ø±ÙŠØ± pdf', 'ÙˆØ«ÙŠÙ‚Ø©',
  'Ø§Ø¹Ù…Ù„ Ø§ÙƒØ³Ù„', 'Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù…Ù„Ù Ø§ÙƒØ³Ù„', 'ØªÙ‚Ø±ÙŠØ± Ø¹Ù†',
  // French
  'crÃ©er pdf', 'faire pdf', 'rapport pdf', 'document pdf',
  'crÃ©er excel', 'feuille excel', 'tableur', 'rapport sur'
];

if (documentKeywords.some(kw => lower.includes(kw))) return 'document';
```

**Change 2: Add document system prompt (in buildSystemPrompt function)**

```typescript
if (intent === 'document') {
  return `${basePrompt}

DOCUMENT GENERATION MODE:
You are creating structured content for a professional document.
RESPOND ONLY WITH VALID JSON in this exact format:

{
  "type": "pdf" or "excel",
  "language": "ar" or "en" or "fr",
  "title": "Document Title",
  "sections": [
    { "heading": "Section Name", "content": "Paragraph text..." },
    { "heading": "Data Section", "table": { 
      "headers": ["Col1", "Col2"], 
      "rows": [["Value1", "Value2"], ...] 
    }}
  ]
}

IMPORTANT:
- Match the language of the user's request
- For Arabic: use proper Arabic text, right-to-left formatting will be handled
- For French: use proper accents (Ã©, Ã¨, Ãª, etc.)
- Create comprehensive, professional content
- Include at least 3-5 sections with real, valuable information`;
}
```

**Change 3: Add document generation handler (in main serve function)**

```typescript
// After detecting document intent
if (intent === 'document') {
  // Get structured content from LLM
  const llmResponse = await callWithFallback('chat', messages, false, supabase, userId);
  const content = llmResponse.response.content;
  
  // Parse JSON from response
  let documentData;
  try {
    const jsonMatch = content.match(/\{[\s\S]*\}/);
    documentData = JSON.parse(jsonMatch[0]);
  } catch {
    return new Response(JSON.stringify({
      content: "I'll help you create that document! Could you be more specific about what you'd like in it?",
      intent: 'document'
    }), { headers: { ...corsHeaders, 'Content-Type': 'application/json' } });
  }
  
  // Call generate-document function
  const docResponse = await fetch(`${Deno.env.get('SUPABASE_URL')}/functions/v1/generate-document`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      ...documentData,
      userId
    })
  });
  
  const { downloadUrl, filename } = await docResponse.json();
  
  // Return friendly response with download link
  const responseMessages = {
    ar: `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¨Ù†Ø¬Ø§Ø­! ðŸ“„ [${documentData.title}](${downloadUrl})`,
    fr: `Document crÃ©Ã© avec succÃ¨s! ðŸ“„ [${documentData.title}](${downloadUrl})`,
    en: `Document created successfully! ðŸ“„ [${documentData.title}](${downloadUrl})`
  };
  
  return new Response(JSON.stringify({
    content: responseMessages[documentData.language || 'en'],
    intent: 'document',
    documentUrl: downloadUrl
  }), { headers: { ...corsHeaders, 'Content-Type': 'application/json' } });
}
```

### 3. MODIFY: `src/components/eye/ResponseCard.tsx`

Add beautiful download card detection and rendering.

**Add new import and detection logic:**
```typescript
import { FileText, Download, FileSpreadsheet } from 'lucide-react';
import { useLanguage } from '@/contexts/LanguageContext';

// Inside component, add document link detection
const documentLink = useMemo(() => {
  // Match: ðŸ“„ [Title](url) or ðŸ“Š [Title](url)
  const match = combinedContent.match(/ðŸ“„|ðŸ“Š\s*\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/);
  if (!match) return null;
  
  const isExcel = combinedContent.includes('ðŸ“Š') || match[2].includes('.xlsx');
  return {
    title: match[1],
    url: match[2],
    type: isExcel ? 'excel' : 'pdf'
  };
}, [combinedContent]);
```

**Add download card UI (after the action bar):**
```typescript
{documentLink && (
  <motion.div
    initial={{ opacity: 0, y: 10 }}
    animate={{ opacity: 1, y: 0 }}
    className={cn(
      "mt-4 p-4 rounded-xl border",
      "bg-gradient-to-r from-primary/10 via-primary/5 to-transparent",
      "border-primary/20 hover:border-primary/40 transition-all"
    )}
  >
    <div className={cn(
      "flex items-center gap-4",
      direction === 'rtl' && "flex-row-reverse"
    )}>
      <div className="p-3 rounded-xl bg-primary/20 shrink-0">
        {documentLink.type === 'excel' 
          ? <FileSpreadsheet className="w-6 h-6 text-green-500" />
          : <FileText className="w-6 h-6 text-primary" />
        }
      </div>
      <div className="flex-1 min-w-0">
        <p className="font-semibold text-foreground truncate">
          {documentLink.title}
        </p>
        <p className="text-xs text-muted-foreground">
          {documentLink.type === 'excel' ? 'Excel Spreadsheet' : 'PDF Document'} â€¢ {t('common.readyToDownload')}
        </p>
      </div>
      <Button 
        onClick={() => window.open(documentLink.url, '_blank')}
        className="gap-2 shrink-0"
        size="sm"
      >
        <Download className="w-4 h-4" />
        {t('common.download')}
      </Button>
    </div>
  </motion.div>
)}
```

### 4. MODIFY: `src/contexts/LanguageContext.tsx`

Add translation keys for document feature:

```typescript
// English translations
'document.generating': 'Generating your document...',
'document.ready': 'Document ready!',
'document.downloadPdf': 'Download PDF',
'document.downloadExcel': 'Download Excel',
'common.readyToDownload': 'Ready to download',
'common.download': 'Download',

// Arabic translations
'document.generating': 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯...',
'document.ready': 'Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¬Ø§Ù‡Ø²!',
'document.downloadPdf': 'ØªØ­Ù…ÙŠÙ„ PDF',
'document.downloadExcel': 'ØªØ­Ù…ÙŠÙ„ Excel',
'common.readyToDownload': 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„',
'common.download': 'ØªØ­Ù…ÙŠÙ„',

// French translations
'document.generating': 'GÃ©nÃ©ration du document...',
'document.ready': 'Document prÃªt!',
'document.downloadPdf': 'TÃ©lÃ©charger PDF',
'document.downloadExcel': 'TÃ©lÃ©charger Excel',
'common.readyToDownload': 'PrÃªt Ã  tÃ©lÃ©charger',
'common.download': 'TÃ©lÃ©charger',
```

### 5. MODIFY: `supabase/config.toml`

Add function configuration:
```toml
[functions.generate-document]
verify_jwt = false
```

### 6. MODIFY: `index.html`

Add Arabic font support for proper rendering:
```html
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
```

---

## PDF Visual Design

### English/French (LTR)
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚ â–ˆ   â¬¤ AYN                    RESEARCH REPORT                  â–ˆâ”‚
â”‚ â–ˆ                              January 23, 2026                â–ˆâ”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚                                                                  â”‚
â”‚  EXECUTIVE SUMMARY                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  This comprehensive report examines...                          â”‚
â”‚                                                                  â”‚
â”‚  KEY FINDINGS                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Category     â”‚ Value        â”‚ Growth    â”‚ Status      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Solar        â”‚ 35%          â”‚ +18%      â”‚ Excellent   â”‚    â”‚
â”‚  â”‚ Wind         â”‚ 28%          â”‚ +12%      â”‚ Strong      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Generated by AYN                              Page 1 of 3      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Arabic (RTL)
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚ â–ˆ                  ØªÙ‚Ø±ÙŠØ± Ø¨Ø­Ø«ÙŠ                    AYN â¬¤        â–ˆâ”‚
â”‚ â–ˆ                Ù¢Ù£ ÙŠÙ†Ø§ÙŠØ± Ù¢Ù Ù¢Ù¦                                 â–ˆâ”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚                                                                  â”‚
â”‚                                              Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                          ...ÙŠØªÙ†Ø§ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„           â”‚
â”‚                                                                  â”‚
â”‚                                              Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ Ø§Ù„Ø­Ø§Ù„Ø©      â”‚ Ø§Ù„Ù†Ù…Ùˆ      â”‚ Ø§Ù„Ù‚ÙŠÙ…Ø©     â”‚ Ø§Ù„ÙØ¦Ø©        â”‚  â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚    â”‚ Ù…Ù…ØªØ§Ø²      â”‚ +Ù¡Ù¨Ùª       â”‚ Ù£Ù¥Ùª        â”‚ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©â”‚  â”‚
â”‚    â”‚ Ù‚ÙˆÙŠ        â”‚ +Ù¡Ù¢Ùª       â”‚ Ù¢Ù¨Ùª        â”‚ Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø­   â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Ù£ Ù…Ù† Ù¡ ØµÙØ­Ø©                              ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© AYN â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example Conversations

### Arabic Request
```
Ø£Ù†Øª: Ø§Ø¹Ù…Ù„ Ù„ÙŠ PDF ØªÙ‚Ø±ÙŠØ± Ø¹Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©

AYN: ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­! 

     ðŸ“„ [ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©](https://...)
     
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ðŸ“¥ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ                    â”‚
     â”‚  Ù…Ø³ØªÙ†Ø¯ PDF â€¢ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„                     â”‚
     â”‚                              [ØªØ­Ù…ÙŠÙ„]          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### French Request
```
Vous: CrÃ©er un PDF sur les tendances du marchÃ© franÃ§ais

AYN: Document crÃ©Ã© avec succÃ¨s!

     ðŸ“„ [Rapport sur les Tendances du MarchÃ© FranÃ§ais](https://...)
     
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ðŸ“¥ Tendances du MarchÃ© FranÃ§ais              â”‚
     â”‚  Document PDF â€¢ PrÃªt Ã  tÃ©lÃ©charger            â”‚
     â”‚                        [TÃ©lÃ©charger]          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### English Request
```
You: Make an Excel sheet comparing AI companies

AYN: Here's your comparison spreadsheet!

     ðŸ“Š [AI Companies Comparison](https://...)
     
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ðŸ“¥ AI Companies Comparison                   â”‚
     â”‚  Excel Spreadsheet â€¢ Ready to download        â”‚
     â”‚                        [Download]             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technical Implementation: RTL Arabic PDF

The key to perfect Arabic PDFs is proper RTL handling in jsPDF:

```typescript
// 1. Load Noto Sans Arabic font (embedded as base64 or via URL)
const arabicFont = await fetch('https://fonts.gstatic.com/s/notosansarabic/...');
doc.addFileToVFS('NotoSansArabic.ttf', arabicFontBase64);
doc.addFont('NotoSansArabic.ttf', 'NotoSansArabic', 'normal');

// 2. Enable RTL mode
doc.setR2L(true);

// 3. Position text from right side
const pageWidth = doc.internal.pageSize.getWidth();
doc.setFont('NotoSansArabic');
doc.text(arabicTitle, pageWidth - margin, yPosition, { align: 'right' });

// 4. Draw tables with RTL column order
const reversedHeaders = headers.reverse();
const reversedRows = rows.map(row => row.reverse());
```

---

## Summary of All Changes

| File | Action | Purpose |
|------|--------|---------|
| `supabase/functions/generate-document/index.ts` | **Create** | PDF/Excel generation with RTL/multi-language |
| `supabase/functions/ayn-unified/index.ts` | **Modify** | Add document intent + generation routing |
| `src/components/eye/ResponseCard.tsx` | **Modify** | Add download card UI with RTL support |
| `src/contexts/LanguageContext.tsx` | **Modify** | Add translation keys for document feature |
| `supabase/config.toml` | **Modify** | Add function configuration |
| `index.html` | **Modify** | Add Noto Sans Arabic font |

---

## Result

After implementation:
- Users can request PDFs/Excel in English, Arabic, or French naturally
- Arabic documents render perfectly with RTL layout and proper fonts
- French documents include proper accent handling
- Beautiful download cards appear in chat with language-aware labels
- Documents are stored securely with 7-day expiring URLs
- Professional styling with AYN branding in all languages
