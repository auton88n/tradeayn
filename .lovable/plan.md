

# Document Generation Improvements

## Overview
5 key improvements to create cleaner, more professional documents:

1. **Remove AYN branding** from PDF and Excel (no header logo, no footer text)
2. **Fix table padding** - more space between cell edges and text
3. **Prevent table page breaks** - keep tables on single page
4. **Human-style writing** - natural content that won't be flagged as AI-generated
5. **Inline download text** - replace the card with a simple "Download here" clickable link in the response

---

## File Changes

### 1. `supabase/functions/generate-document/index.ts`

**Remove Branding:**
- Delete "AYN" logo text from header (lines 136-143)
- Remove `getFooterText()` function that returns "Generated by AYN" (lines 84-91)
- Update `addFooter()` to show only page number, no brand text

**Fix Table Padding:**
- Header cell height: 10px â†’ 14px
- Row cell height: 8px â†’ 12px  
- Add 3mm horizontal padding to text positioning
- Adjust text Y offset for better vertical centering

**Prevent Table Page Breaks:**
Before drawing any table:
```text
1. Calculate: tableHeight = headerHeight + (rowCount Ã— rowHeight)
2. Calculate: remainingSpace = pageHeight - currentY - bottomMargin
3. If tableHeight > remainingSpace â†’ add new page first
4. Then draw the complete table on the fresh page
```

**Excel Changes:**
- Remove the footer row that adds "Generated by AYN" (line 357)

### 2. `supabase/functions/ayn-unified/index.ts`

**Add Human-Style Writing Instructions to Document Mode (lines 344-352):**

Add these rules after the existing CRITICAL RULES:

```text
WRITING STYLE (CRITICAL - write like a human expert):
- Vary sentence length naturally - some short, some longer
- Occasionally start sentences with "And", "But", "Now"
- Include subtle opinions: "Interestingly,", "What stands out is..."
- Use contractions: "it's", "don't", "won't", "that's"
- Add parenthetical asides and em-dashes for natural flow
- Vary paragraph length - some 2 sentences, some 4-5
- NEVER use: "It is important to note", "Furthermore", "In conclusion", "Additionally", "Moreover"
- Write conversationally like you're explaining to a colleague
```

### 3. `src/components/eye/ResponseCard.tsx`

**Replace Document Download Card with Inline Link (lines 425-471):**

Remove the entire download card section. The document link will be rendered through the existing markdown content from the backend.

**Update `ayn-unified` response format:**
When a document is ready, the AI will include a natural sentence with the link, like:

```text
Your document is ready. [Download here](data:application/pdf;base64,...)
```

This renders as a clickable "Download here" link via the existing `MessageFormatter` component. The `onClick` will trigger `openDocumentUrl()` for the download.

### 4. `src/lib/documentUrlUtils.ts` (minor update)

Update `extractBestDocumentLink` to also match simple "[Download here](...)" links so clicking triggers the proper download behavior.

---

## Visual Changes

### Before (Current)
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response text here...                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“„ Greenland Report           [Download]â”‚  â”‚
â”‚  â”‚    PDF Document â€¢ Ready                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After (Cleaner)
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response text here...                       â”‚
â”‚                                              â”‚
â”‚  Your document is ready. Download here â†     â”‚
â”‚                           (clickable link)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PDF Header Change
```text
Before:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AYN                         Jan 2026 â”‚
â”‚ Document Title                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Title              Jan 2026 â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Table Padding
```text
Before:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Featureâ”‚Metricâ”‚Details â”‚  â† text touching edges
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Feature  â”‚  Metric  â”‚   â”‚  â† 3mm padding each side
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

| Change | File |
|--------|------|
| Remove "AYN" header + footer branding | `generate-document/index.ts` |
| Increase table cell padding | `generate-document/index.ts` |
| Keep tables on single page | `generate-document/index.ts` |
| Human-style writing instructions | `ayn-unified/index.ts` |
| Remove download card, use inline "Download here" link | `ResponseCard.tsx` |
| Update link extraction for download | `documentUrlUtils.ts` |

